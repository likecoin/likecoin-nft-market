import{_ as G,c as H,a as Q}from"./index.eeb5559a.js";import{_ as X}from"./UserLink.vue_vue_type_script_setup_true_lang.ee0c81cb.js";import{a as Y,b as Z,s as tt,v as et,r as w,f as I,e as at,h as o,i as t,t as p,u as n,k as C,l as F,m as T,F as E,j as V,o as l,c as nt,w as st}from"./entry.facaa369.js";import{d as lt,e as ot,f as rt,h as it,i as ut,j as ct,k as M,l as dt,s as yt,B as ht,m as _t}from"./cosmos.2eae727f.js";import{u as vt}from"./wallet.0a440043.js";import{u as ft}from"./metadata.97daaf0f.js";async function gt(x){var b;try{return(await lt.get(`${ot}/likernft/purchase?class_id=${x}`)).data}catch(N){return((b=N.response)==null?void 0:b.status)!==404&&console.error(JSON.stringify(N)),null}}const mt=t("br",null,null,-1),wt=["src"],pt=t("br",null,null,-1),Nt=["href"],kt=t("br",null,null,-1),bt=t("h3",null,"Royalty Table",-1),It={key:0},Ct=t("thead",null,[t("tr",null,[t("th",null,"Account"),t("th",null,"Ratio")])],-1),Ft={key:1},Tt=t("h2",null,"Listings",-1),Bt={key:0},Lt={key:1},St=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"NFT information"),t("th",null,"Listing Price")])],-1),xt=t("br",null,null,-1),Rt={key:0},Pt=["onClick"],Mt=Y({__name:"[classId]",setup(x){const b=Z(),N=tt(),R=vt(),O=ft(),{wallet:_,signer:m}=et(R),P=w([]),W=w([]),v=w(null),y=w({}),h=w({}),B=w(null),f=I(()=>N.params.classId),q=I(()=>[].concat(...P.value,...W.value).sort((e,r)=>e.price.toNumber()-r.price.toNumber())),L=I(()=>{var s,u,i,c;const e=((s=v.value)==null?void 0:s.rateBasisPoints)/100||0,r=((u=v.value)==null?void 0:u.stakeholders.reduce((d,g)=>d+g.weight,0))||1;return(c=(i=v.value)==null?void 0:i.stakeholders)==null?void 0:c.map(d=>({...d,weight:d.weight/r*e}))}),j=I(()=>{var i,c,d;const e=!!h.value,r=h.value.owner===_.value,s=((i=B.value)==null?void 0:i.length)!==((c=v.value)==null?void 0:c.stakeholders.length),u=(d=B.value)==null?void 0:d.some((g,a)=>{var S;const k=(S=v.value)==null?void 0:S.stakeholders[a];return!k||g.account!==k.account||g.weight!==k.weight});return e&&r&&s&&u}),{connect:D}=R,{lazyFetchClassMetadata:A}=O;at(async()=>{await Promise.all([A(f.value).then(e=>{y.value=e,e.data.parent.iscnIdPrefix&&K(y.value.data.parent.iscnIdPrefix)}),rt(f.value).then(e=>P.value=e),z(f.value),$()])});async function K(e){h.value=await it(e),B.value=await ut(h.value.data,h.value.owner)}async function $(){try{const e=await ct(f.value);if(!e)return;const r=e.stakeholders.map(s=>({account:M.encode("like",M.toWords(s.account)),weight:s.weight.toNumber()}));v.value={rateBasisPoints:e.rateBasisPoints.toNumber(),stakeholders:r}}catch(e){console.error(e)}}async function U(){if((!_.value||!m.value)&&await D(),!_.value||!m.value||!h.value)return;const e=await yt(f.value,h.value.data,h.value.owner,!!v.value,m.value,_.value);console.log(e),await $()}async function z(e){const r=await gt(e);if(r){const{price:s,metadata:{nextNewNFTId:u,ownerWallet:i}}=r;W.value=[{classId:e,nftId:u,price:dt.fromNumber(s*1e9),seller:i,isWritingNFT:!0}]}}async function J({classId:e,nftId:r,seller:s,price:u}){if((!_.value||!m.value)&&await D(),!_.value||!m.value)return;const i=new ht(u).shiftedBy(-9).toNumber(),c=await _t(e,r,s,i,m.value,_.value);console.log(c),b.push({path:"/owned"})}return(e,r)=>{var i,c,d,g;const s=G,u=X;return l(),o("div",null,[t("h1",null,p(n(y).name),1),mt,(c=(i=n(y).data)==null?void 0:i.metadata)!=null&&c.image?(l(),o("img",{key:0,src:n(H)(n(y).data.metadata.image),width:"256",height:"256"},null,8,wt)):C("",!0),pt,t("p",null,p(n(y).description),1),t("div",null,[F("Class ID: "),T(s,{"class-id":n(f)},null,8,["class-id"])]),(g=(d=n(y).data)==null?void 0:d.metadata)!=null&&g.external_url?(l(),o("a",{key:1,href:n(y).data.metadata.external_url,target:"_blank",rel:"noopener"},"View External Link",8,Nt)):C("",!0),kt,t("section",null,[bt,n(L)&&n(L).length?(l(),o("table",It,[Ct,t("tbody",null,[(l(!0),o(E,null,V(n(L),a=>(l(),o("tr",{key:a.account},[t("td",null,[T(u,{wallet:a.account},null,8,["wallet"])]),t("td",null,p(a.weight)+"%",1)]))),128))])])):(l(),o("div",Ft," No royalty config found, all revenue on marketplace sales is collected by seller. ")),n(j)?(l(),o("button",{key:2,onClick:U}," Press to sync NFT royalty config according to ISCN stakeholders ")):C("",!0)]),Tt,t("section",null,[n(q).length?(l(),o("table",Lt,[St,t("tbody",null,[(l(!0),o(E,null,V(n(q),(a,k)=>(l(),o("tr",{key:`${a.classId}_${a.nftId}`},[t("td",null,"#"+p(k+1),1),t("td",null,[t("div",null,[F(" NFT ID: "),T(s,{"class-id":a.classId,"nft-id":a.nftId},null,8,["class-id","nft-id"]),xt,F(" Sold by: "),T(u,{wallet:a.seller},null,8,["wallet"])])]),t("td",null,[t("section",null,[t("div",null,p(n(Q)(a.price))+" LIKE",1),a.expiration?(l(),o("div",Rt,"till "+p(a.expiration),1)):C("",!0)]),a.isWritingNFT?(l(),nt(s,{key:0,"class-id":n(f)},{default:st(()=>[F("Buy from liker.land")]),_:1},8,["class-id"])):(l(),o("button",{key:1,onClick:S=>J(a)},"Buy",8,Pt))])]))),128))])])):(l(),o("div",Bt,"No one is selling this NFT yet"))])])}}});export{Mt as default};

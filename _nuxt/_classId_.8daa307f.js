import{_ as G,c as H,a as J}from"./index.6f1f47e5.js";import{_ as Q}from"./UserLink.vue_vue_type_script_setup_true_lang.2a60c831.js";import{a as X,b as Y,s as Z,v as tt,r as w,f as k,e as et,h as o,i as t,t as p,u as n,k as b,l as I,m as C,F as W,j as D,o as s,c as at,w as nt}from"./entry.66d368a4.js";import{d as lt,e as st,f as ot,h as rt,i as V,j as it,s as ut,B as ct,k as dt}from"./cosmos.04f9d3c0.js";import{u as yt}from"./wallet.031c2a45.js";import{u as ht}from"./metadata.d863c358.js";import{q as _t}from"./likeco.9ee1a8a5.js";const vt=t("br",null,null,-1),ft=["src"],mt=t("br",null,null,-1),gt=["href"],wt=t("br",null,null,-1),pt=t("h3",null,"Royalty Table",-1),Nt={key:0},kt=t("thead",null,[t("tr",null,[t("th",null,"Account"),t("th",null,"Ratio")])],-1),bt={key:1},It=t("h2",null,"Listings",-1),Ct={key:0},Ft={key:1},Tt=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"NFT information"),t("th",null,"Listing Price")])],-1),Bt=t("br",null,null,-1),Lt={key:0},St=["onClick"],Et=X({__name:"[classId]",setup(Rt){const $=Y(),E=Z(),L=yt(),M=ht(),{wallet:_,signer:g}=tt(L),S=w([]),R=w([]),v=w(null),y=w({}),h=w({}),F=w(null),f=k(()=>E.params.classId),x=k(()=>[].concat(...S.value,...R.value).sort((e,r)=>e.price.toNumber()-r.price.toNumber())),T=k(()=>{var l,u,i,c;const e=((l=v.value)==null?void 0:l.rateBasisPoints)/100||0,r=((u=v.value)==null?void 0:u.stakeholders.reduce((d,m)=>d+m.weight,0))||1;return(c=(i=v.value)==null?void 0:i.stakeholders)==null?void 0:c.map(d=>({...d,weight:d.weight/r*e}))}),j=k(()=>{var i,c,d;const e=!!h.value,r=h.value.owner===_.value,l=((i=F.value)==null?void 0:i.length)!==((c=v.value)==null?void 0:c.stakeholders.length),u=(d=F.value)==null?void 0:d.some((m,a)=>{var B;const N=(B=v.value)==null?void 0:B.stakeholders[a];return!N||m.account!==N.account||m.weight!==N.weight});return e&&r&&l&&u}),{connect:q}=L,{lazyFetchClassMetadata:U}=M;et(async()=>{await Promise.all([U(f.value).then(e=>{y.value=e,e.data.parent.iscnIdPrefix&&z(y.value.data.parent.iscnIdPrefix)}),lt(f.value).then(e=>S.value=e),K(f.value),P()])});async function z(e){h.value=await st(e),F.value=await ot(h.value.data,h.value.owner)}async function P(){try{const e=await rt(f.value);if(!e)return;const r=e.stakeholders.map(l=>({account:V.encode("like",V.toWords(l.account)),weight:l.weight.toNumber()}));v.value={rateBasisPoints:e.rateBasisPoints.toNumber(),stakeholders:r}}catch(e){console.error(e)}}async function A(){if((!_.value||!g.value)&&await q(),!_.value||!g.value||!h.value)return;const e=await ut(f.value,h.value.data,h.value.owner,!!v.value,g.value,_.value);console.log(e),await P()}async function K(e){const r=await _t(e);if(r){const{price:l,metadata:{nextNewNFTId:u,ownerWallet:i}}=r;R.value=[{classId:e,nftId:u,price:it.fromNumber(l*1e9),seller:i,isWritingNFT:!0}]}}async function O({classId:e,nftId:r,seller:l,price:u}){if((!_.value||!g.value)&&await q(),!_.value||!g.value)return;const i=new ct(u).shiftedBy(-9).toNumber(),c=await dt(e,r,l,i,g.value,_.value);console.log(c),$.push({path:"/owned"})}return(e,r)=>{var i,c,d,m;const l=G,u=Q;return s(),o("div",null,[t("h1",null,p(n(y).name),1),vt,(c=(i=n(y).data)==null?void 0:i.metadata)!=null&&c.image?(s(),o("img",{key:0,src:n(H)(n(y).data.metadata.image),width:"256",height:"256"},null,8,ft)):b("",!0),mt,t("p",null,p(n(y).description),1),t("div",null,[I("Class ID: "),C(l,{"class-id":n(f)},null,8,["class-id"])]),(m=(d=n(y).data)==null?void 0:d.metadata)!=null&&m.external_url?(s(),o("a",{key:1,href:n(y).data.metadata.external_url,target:"_blank",rel:"noopener"},"View External Link",8,gt)):b("",!0),wt,t("section",null,[pt,n(T)&&n(T).length?(s(),o("table",Nt,[kt,t("tbody",null,[(s(!0),o(W,null,D(n(T),a=>(s(),o("tr",{key:a.account},[t("td",null,[C(u,{wallet:a.account},null,8,["wallet"])]),t("td",null,p(a.weight)+"%",1)]))),128))])])):(s(),o("div",bt," No royalty config found, all revenue on marketplace sales is collected by seller. ")),n(j)?(s(),o("button",{key:2,onClick:A}," Press to sync NFT royalty config according to ISCN stakeholders ")):b("",!0)]),It,t("section",null,[n(x).length?(s(),o("table",Ft,[Tt,t("tbody",null,[(s(!0),o(W,null,D(n(x),(a,N)=>(s(),o("tr",{key:`${a.classId}_${a.nftId}`},[t("td",null,"#"+p(N+1),1),t("td",null,[t("div",null,[I(" NFT ID: "),C(l,{"class-id":a.classId,"nft-id":a.nftId},null,8,["class-id","nft-id"]),Bt,I(" Sold by: "),C(u,{wallet:a.seller},null,8,["wallet"])])]),t("td",null,[t("section",null,[t("div",null,p(n(J)(a.price))+" LIKE",1),a.expiration?(s(),o("div",Lt,"till "+p(a.expiration),1)):b("",!0)]),a.isWritingNFT?(s(),at(l,{key:0,"class-id":n(f)},{default:nt(()=>[I("Buy from liker.land")]),_:1},8,["class-id"])):(s(),o("button",{key:1,onClick:B=>O(a)},"Buy",8,St))])]))),128))])])):(s(),o("div",Ct,"No one is selling this NFT yet"))])])}}});export{Et as default};
